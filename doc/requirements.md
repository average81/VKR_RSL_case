# Требования и уточнение задачи

## Функциональные требования

Программный комплекс должен:
1. работать автономно на рабочей станции.
2. сравнивать изображения отсканированных страниц, упорядоченных по порядку сканирования
и находить дубликаты страниц и титульные страницы выпусков газет/журналов.
3. Среди дубликатов страниц оставлять изображения лучшего качества (качество оценивать по степени размытости
изображений, распределению оттенков по гистограммам).
4. обнаруживать дефекты на изображениях, имеющих дубликаты (царапины, коробление бумаги, иные дефекты пленки) и 
восстанавливать поврежденные области аналогичными из дубликатов. При вставке областей изображения из дубликата
 проводить регистрацию изображений страниц перед изъятием  области для замены в дубликате, выравнивать статистические параметры области изображения с оригиналом.
5. группировать изображения по выпускам, опираясь на обнаруженные титульные листы (по логотипу и названию), которые являются разделителями 
выпусков в упорядоченном датасете изображений.
6. Сохранять результаты работы по папкам выпусков, удаленные дубликаты помещать внутри папок выпусков в папке дубликатов.
7. Сохранять восстановленные страницы из нескольких дубликатов в папку внутри папок выпусков, в отдельном файле json
сохранять сегментацию дефектов.
8. При наличии в данных поврежденных файлов, сохранять их в отдельную папку внутри папки выпуска.
9. Результаты работы (файлы в структуре папок) должны сохраняться в защищенном хранилище.
10. Иметь функцию авторизации пользователей для доступа к защищенному хранилищу, 
удалять все временные файлы (включая файлы браузера) по окончанию работы.
11. Иметь функцию логирования авторизации пользователей и выполненных ими работ в базе данных.

Структура папок выходных данных:  
|-"Название выпуска"_ID  
|--Дубликаты  
|--Восстановленные  
|--Поврежденные

Структура JSON файла разметки дефектов:  
{
"file": имя файла,
"type": тип дефекта,
"mask": пиксельная маска дефекта,
"d_file": - файл дубликата, из которого взят поврежденный фрагмент
}

## Нефункциональные требования

Будем опираться на рабочую станцию со следующими параметрами:
процессор AMD Ryzen3 1200, 16Гб ОЗУ, GPU RTX3060 12Гб.  Это бюджетная рабочая станция, установка станции с такими 
характеристиками не должно вызвать затруднений.

Программный комплекс должен:
1. иметь скорость обработки изображений: < 10с на изображение (поиск дубликатов, поиск титульных страниц и восстановление дефектов на страницах, имеющих дубликаты).
2. иметь точность нахождения дубликатов страниц не хуже 90%, полнота - не хуже 0.8.
3. иметь точность определения титульных страниц не хуже 95%, полнота - не хуже 0.9.
4. иметь точность определения дефектов страниц: mAP > 0.35 (Высокая точность сегментации необязательна ввиду вставки на 
место дефекта аналогичной области из дубликата), полнота обнаружения дефектов - более 0.7. 

## Интерфейсы

Программный комплекс должен взаимодействовать с пользователем через графический локальный web интерфейс (на локальном ПК).
Такая реализация позволит масштабировать программный комплекс в сетевой сервис при необходимости.  
Форматы изображений на входе и выходе работы программного комплекса: PNG.

## Данные

Все изображения после авторизации пользователя в программном комплексе извлекаются из защищенного хранилища.  

## Приемочные тесты

Программный комплекс тестируется на рабочей станции заказчика на изображениях страниц 50 выпусков газет, не менее 5 которых
содержат дубликаты. Ошибка определения титульных страниц должна быть не более 10%, ошибка определения дубликатов страниц 
должна быть не более 10%.

## Открытые вопросы

На данный момент остаются вопросы, требующие ответа от заказчика, для дальнейшей работы:
1. Тип защищенного хранилища и возможность его применения.
2. Тип авторизации пользователей, если есть такая необходимость.
3. Необходимость безопасного удаления файлов на локальной станции.