# Постановка задачи.

## Проблема
Оцифровка архивов периодических изданий с микрофильмов порождает следующие проблемы:
- появление дубликатов оцифрованных страниц из-за того, что при микрофильмировании зачастую фотографы делают по 
несколько кадров одной страницы, стремясь получить лучший кадр.
- Отсутствие разделения выпусков периодических изданий при микрофильмировании, что затрудняет
упорядочивание цифровых копий страниц по выпускам для дальнейшей обработки.
Таким образом можно выделить 2 независимые задачи при первичной обработке цифровых копий страниц периодических изданий:
1. Задача обнаружения дубликатов страниц.
2. Задача группировки страниц по выпускам периодики.

Из факта наличия нескольких дубликатов страниц в цифровых копиях и наличии различных дефектов на них
может быть сформулирована дополнительная задача, вытекающая из первой:
- Задача улучшения качества страниц, имеющих дубликаты.

## Формулировка задачи

Эти задачи правильно выполнять с помощью технологий компьютерного зрения.
Представленные задачи в терминах компьютерного зрения 
переформулируются следующим образом:
1. Задача сравнения цифровых копий страниц для выявления и 
устранения одинаковых копий одной страницы среди 
множества цифровых копий страниц периодических изданий (скан-копий).
В результате необходимо оставить одну из цифровых копий, имеющую
наиболее высокое качество, определенный на основе параметров 
контраста, резкости, яркости, цветовой насыщенности.
2. Задача кластеризации цифровых копий страниц периодических изданий
по номерам выпусков из массива цифровых копий страниц разных номеров периодических изданий.
3. Задача сегментации дефектов цифровых копий страниц, имеющих
дубликаты, замена сегментов с дефектами на такие же сегменты 
из других копий.

## Стейкхолдеры

Продукт, реализующий описанные задачи, может быть использован во всех архивах и библиотеках
 для повышения производительности труда в работе создания и упорядочивания цифровых копий архивных данных.
На данный момент нет детализированного технического задания,
поэтому требования к проекту могут изменяться в ходе выполнения.

## Ограничения

Ввиду того, что большая часть архивных данных не должна быть доступна широкому кругу лиц или
 доступ к ним возможен только для просмотра, разворачивание сетевого сервиса, решающего задачи,
 связанные с созданием и упорядочиванием цифровых копий архивных данных может нести риски 
утечки данных. Поэтому целесообразно разворачивать такие сервисы на локальных машинах в самих
архивах. Для обеспечения безопасности данных при создании программного обеспечения может потребоваться
реализация методов разграничения доступа и авторизации пользователей.
Также имеет смысл удалять все временные файла по окончании работы программы.  
Требований к скорости обработки изображений также не предъявляется.  
Ввиду того, что проект является некоммерческим, ограничений по использованию открытых лицензий компонентов тоже нет,
как нет и юридических ограничений в использовании компонентов и датасета.  
В условиях описанных неопределенностей будем опираться на разворачивание проекта на локальной станции с 
возможностью выполнения параллельных вычислений с использованием технологии CUDA на видеокарте.
Будем опираться на бюджетные модели видеокарт RTX3060 12Гб, обеспечивающие достаточный объем
памяти для работы многих современных алгоритмов работы с изображениями, широкой поддержкой в
библиотеках обработки данных. 

На данный момент нет данных о времени ручной обработки цифровых копий страниц человеком, а также
метрик качества такой обработки. Также нет данных о том, какие метрики качества работы компьютерного алгоритма
могут считаться успешными при реализации поставленных задач.
В таких условиях имеет смысл опираться на метрики качества алгоритмов, решающих близкие задачи.

## Обзор известных решений

Известные решения используют как классические алгоритмы компьютерного зрения, так и нейросетевые модели:
1. Метод поиска нечетких дубликатов
   изображений на основе выявления точечных особенностей. [1]
2. Алгоритм обнаружения искаженных дубликатов на цифровых изображениях
с использованием бинарных градиентных контуров. [2]
3. Устройство поиска дубликатов изображений. [3]
4. Программа "Visual Similarity Duplicate Image Finder" [4]
5. Детектирование специализированных категорий объектов на фотографиях в мобильных
устройствах на основе многозадачной нейросетевой модели. [5]
6. Система оцифровки газет "Технологика". [6]
7. Применение пошаговой сегментации для распознавания нечетких дубликатов изображения. [7]
8. Deep Metric Learning for Near-Duplicate Video
   Retrieval Leveraging Efficient Semantic
   Feature Extraction [8]
9. Near duplicate text detection using graph depiction. [9]
10. py-image-dedup. [10]

Довольно большое количество статей и решений существует по поиску неточных/искаженных копий изображений.
Такие решения используют как классические методы работы с изображениями, так и нейросетевые модели. 
Особенно много программ по работе с частными фотоархивами, имеющих ряд дополнительных функций.
Решений, реализующих группировку изображений по какому-то признаку в них найти сложно, но эта задача может быть решена 
частными методами, такими как поиск логотипа газеты на титульной странице, поиск номеров страниц для группировки.

Сводная таблица некоторых найденных решений

| Название решения/подхода                                                                                                                 | Тип задачи                                                                                                                                            | Используемые методы и инструменты                                                                                                                                                               | Преимущества и недостатки                                                                                                                                                                                          | Лицензия                                                                                      | edge/cloud                              |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|-----------------------------------------|
| Метод поиска нечетких дубликатов изображений на основе выявления точечных особенностей                                                   | Сравнение изображений по ключевым точкам                                                                                                              | SIFT + фильтрация дескрипторов + QT расчет взаимных расстояний векторов дескрипторов                                                                                                            | Быстро работает даже на процессоре, но точность не более 79% при полноте 63%.                                                                                                                                      | Патент на SIFT алгоритм истек, возможно свободное применение.                                 | Готового решения на базе алгоритма нет. |
| Алгоритм обнаружения искаженных дубликатов на цифровых изображениях с использованием бинарных градиентных контуров                       | Сравнение изображений методом бинарных градиентных контуров                                                                                           | Не использует готовые библиотеки                                                                                                                                                                | Устойчив к изменению качества изображения без изменения содержания. Не требует серьезных вычислительных ресурсов                                                                                                   | Нет библиотек, реализующих алгоритм.                                                          | Реализация отсутствует.                 |
| Устройство поиска дубликатов изображений                                                                                                 | Сравнение изображений по ключевым точкам                                                                                                              | Преобразование в цветовое пространство AIQ + ASIFT                                                                                                                                              | Более устойчив к перепадам яркости, чем ASIFT.                                                                                                                                                                     | CeCILL-C у ASIFT (аналог GPL), статус патента неопределен, вероятно, просрочен платеж.        | Нет готового продукта.                  |
| Программа "Visual Similarity Duplicate Image Finder"                                                                                     | Сравнение изображений, ранжирование изображений по степени сходства                                                                                   | Не описаны                                                                                                                                                                                      | Предназначена для работы с частными фотоархивами. Нет данных о работе со сканами текста.                                                                                                                           | Платная версия.                                                                               | Работает на ПК.                         |
| Детектирование специализированных категорий объектов на фотографиях в мобильных устройствах на основе многозадачной нейросетевой модели. | Сравнение фотографий на основе последовательной классификации объектов на фото                                                                        | Использование нескольких классификационных независимых слоев с общей обученной нейросетью.                                                                                                      | Точность классификации объектов на изображении выше точности моделей с одним классификационным слоем. Недостатки: необходимость обучения нескольких классификационных слоев, требует больше вычислений при работе. | Метод не лицензируется. Под лицензии могут подпадать отдельные модули применяемых нейросетей. | Реализации нет                          |
| Система оцифровки газет "Технологика"                                                                                                    | Распознавание текста газет с сохранением структуры докумета                                                                                           | Не раскрываются. Есть данные о наличии предварительной обработки для устранения дефектов в виде царапин, пыли, короблении бумаги, выцветании краски на буквах.                                  | Степень распознавания 98-99%, возможность ручной корректировки распознания структуры и текста.                                                                                                                     | Разработана под заказ, повторное использование невозможно                                     | Нет данных                              |
| Применение пошаговой сегментации для распознавания нечетких дубликатов изображения.                                                      | Сравнение изображений после сегментации на кластеры с помощью нейросети                                                                               | Косинусное расстояние между векторами, описывающими характеристики кластеров сегментации                                                                                                        | Хорошо обнаруживает дубликаты при искажениях размытия, изменения яркости и контраста, изменении разрешения.                                                                                                        | Нет                                                                                           | Нет готовой реализации                  |
| Deep Metric Learning for Near-Duplicate Video Retrieval Leveraging Efficient Semantic Feature Extraction                                 | Нахождение неточных дубликатов видео.                                                                                                                 | Сравнение группы кадров на основе построения векторов признаков, извлекаемых из всех слоев нейросети VGG-16, обрабатывающей кадры. Сравнение векторов признаков на основе Евклидова расстояния. | Точность поиска неточных дубликатов достигает 98.5%.                                                                                                                                                               | Нет                                                                                           | Реализации нет.                         |
|Near duplicate text detection using graph depiction| Определение близких по содержанию текстов                                                                                                             | Используется метод векториации текста с последующим вычислением коэффициентов ранга Кенталя, аппроксимацией результата полиномиальной функцией и вычислением критерия плагиата.                 | Работает с текстовыми данными                                                                                                                                                                                      | нет                                                                                           | Нет реализации                          |
|py-image-dedup| Сканирование директорий и сравнение файлов изображений на предмет неточных дубликатов. Возможно удаление или перемещение дубликатов в отдельную папку | Использует вычисление pHash изображений и последующее сравнение.                                                                                                                                | Библиотека с простым CLI интерфейсом, но нет настроек порога срабатывания алгоритма сравнения изображений                                                                                                          | AGPL-3.0                                                                                      | Работает на локальном ПК.               |


Методы 1-6, 8, 10 могут быть использованы для поиска дубликатов сканов страниц, метод 7 - для поиска титульных страниц газет 
для кластеризации сканов страниц по выпускам газет. Метод 9 может быть использован при невозможности точного поиска 
дубликатов страниц по изображению и необходимости распознания текста.

---

[1]: В. Ю. Пименов. Метод поиска нечетких дубликатов
изображений на основе выявления точечных особенностей.
Труды РОМИП 2007-2008, с. 145-158. СПб.:НУ ЦСИ, 2008.  
[2]: А. В. Кузнецов, В. В. Мясников. Алгоритм обнаружения искаженных дубликатов на цифровых изображениях
с использованием бинарных градиентных контуров. Компьютерная оптика №2 2016,
с. 284-293.  
[3]: В. И. Марчук. Устройство поиска дубликатов изображений. Патент на изобретение RU 2538319 C1, 2015.  
[4]: Программа "Visual Similarity Duplicate Image Finder". https://www.mindgems.com/products/VS-Duplicate-Image-Finder/VSDIF-About.htm
[5]: А. В. Савченко. Детектирование специализированных категорий объектов на фотографиях в мобильных
устройствах на основе многозадачной нейросетевой модели. Информационные технологии, с. 586-593, 2020.  
[6]: Система оцифровки газет "Технологика". https://www.technologika.ru/projects/newspaper-digitization-system  
[7]: В. Б. Немировский, А. К. Стоянов. Применение пошаговой сегментации для распознавания нечетких дубликатов изображения.
Известия Томского политехнического университета. 2014., с. 92-100, Т. 324. № 5.  
[8]: Deep Metric Learning for Near-Duplicate Video
Retrieval Leveraging Efficient Semantic
Feature Extraction. IEEEAccess, 2024, Digital Object Identifier 10.1109/ACCESS.2024.3411101.  
[9]: Near duplicate text detection using graph depiction. IEEEAccess, 2016,  Digital Object Identifier 10.1109/IISA.2016.7785368
[10]: py-image-dedup. https://github.com/markusressel/py-image-dedup?tab=readme-ov-file